{"version":3,"file":"meeting.min.js","sources":["../src/meeting.js"],"sourcesContent":["/* eslint-disable */\nimport { ACTIONS_AJAX_MEETING } from \"./lib/actions\";\nimport { TEMPLATES, renderTemplate } from \"./lib/template\";\n\nM.mod_tutoom = M.mod_tutoom || {};\n\nconst spinnerHTML =\n  \"<div class='spinner-border spinner-border-sm text-dark'></div>\";\n\nexport const getMeeting = async () => {\n  const tutoom = window.tutoom;\n  if (!tutoom || tutoom === undefined) throw new Error(\"Tutoom data is empty\");\n\n  const { baseUrl, id: ID } = tutoom;\n\n  const url = `${baseUrl}?action=${ACTIONS_AJAX_MEETING.GET_MEETING}&sesskey=${M.cfg.sesskey}&id=${ID}`;\n  return await window.fetch(url);\n};\n\nexport const startMeeting = async (e) => {\n  e.preventDefault();\n\n  const tutoom = window.tutoom;\n  if (!tutoom || tutoom === undefined) throw new Error(\"Tutoom data is empty\");\n\n  const { baseUrl, id: ID, isModerator } = tutoom;\n\n  const elementButton = document.getElementById(\"tutoom-start-button\");\n\n  const widthButton = elementButton.offsetWidth;\n  const lastHTML = elementButton.innerHTML;\n\n  elementButton.style.width = `${widthButton}px`;\n  elementButton.innerHTML = spinnerHTML;\n\n  try {\n    const url = `${baseUrl}?action=${ACTIONS_AJAX_MEETING.START_MEETING}&sesskey=${M.cfg.sesskey}&id=${ID}&logoutUrl=${window.location.href}`;\n    const fetch = await window.fetch(url);\n    const response = await fetch.json();\n\n    const { error, roomId, numParticipants, meetingDate } = response;\n\n    if (error) {\n      const data = { error: true, errorcode: error.code, errormessage: error.message };\n      renderTemplate({ data, type: TEMPLATES.MAIN_SECTION });\n    }\n\n    if (roomId) {\n    \n      const data = {\n        meetingid: roomId,\n        ismoderator: isModerator,\n        meetingdate: meetingDate,\n        participantscount: `${numParticipants}`,\n        istextpluralparticipant: numParticipants > 1,\n      };\n\n      renderTemplate({ data, type: TEMPLATES.MAIN_SECTION });\n    }\n  } catch (error) {\n    console.error(error);\n    elementButton.innerHTML = lastHTML;\n  }\n};\n\nexport const joinMeeting = async (e) => {\n  e.preventDefault();\n\n  const tutoom = window.tutoom;\n  if (!tutoom || tutoom === undefined) throw new Error(\"Tutoom data is empty\");\n\n  const { baseUrl, id: ID } = tutoom;\n\n  const elementButton = document.getElementById(\"tutoom-join-button\");\n\n  const widthButton = elementButton.offsetWidth;\n  const lastHTML = elementButton.innerHTML;\n\n  elementButton.style.width = `${widthButton}px`;\n  elementButton.innerHTML = spinnerHTML;\n\n  try {\n    const url = `${baseUrl}?action=${ACTIONS_AJAX_MEETING.JOIN_MEETING}&sesskey=${M.cfg.sesskey}&id=${ID}`;\n    const fetch = await window.fetch(url);\n    const response = await fetch.json();\n\n    const {error, joinurl}  = response;\n    \n    if (error) {\n      if(error.statuscode === 404){\n        const data = { error: true,  meetingidnotexists: true };\n        renderTemplate({ data, type: TEMPLATES.MAIN_SECTION });\n      }else{\n        const data = { error: true, errorcode: error.code, errormessage: error.message };\n        renderTemplate({ data, type: TEMPLATES.MAIN_SECTION });\n      }\n    }\n\n    if (joinurl) {\n      window.location.href = joinurl;\n    }\n\n  } catch (error) {\n    console.error(error);\n  } finally {\n    elementButton.innerHTML = lastHTML;\n  }\n};\n\nexport const endMeeting = async (e) => {\n  e.preventDefault();\n\n  const tutoom = window.tutoom;\n  if (!tutoom || tutoom === undefined) throw new Error(\"Tutoom data is empty\");\n\n  const { baseUrl, id: ID } = tutoom;\n\n  const elementButton = document.getElementById(\"tutoom-end-button\");\n\n  const value = e.target.value;\n  const widthButton = elementButton.offsetWidth;\n  const lastHTML = elementButton.innerHTML;\n\n  elementButton.style.width = `${widthButton}px`;\n  elementButton.innerHTML = `<div class='spinner-border spinner-border-sm text-danger'></div>`;\n\n  try {\n    const url = `${baseUrl}?action=${ACTIONS_AJAX_MEETING.END_MEETING}&sesskey=${M.cfg.sesskey}&id=${ID}&meetingId=${value}`;\n    const fetch = await window.fetch(url);\n    const response = await fetch.json();\n\n    const { error, deleted } = response;\n\n    if (error) {\n      if(error.statuscode === 404){\n        const data = { error: true,  meetingidnotexists: true };\n        renderTemplate({ data, type: TEMPLATES.MAIN_SECTION });\n      }else{\n        const data = { error: true, errorcode: error.code, errormessage: error.message };\n        renderTemplate({ data, type: TEMPLATES.MAIN_SECTION });\n      }\n    }\n\n    if (deleted) clearMainSection(e);\n  } catch (error) {\n    console.error(error);\n  } finally {\n    elementButton.innerHTML = lastHTML;\n  }\n};\n\nexport const clearMainSection = (e) => {\n  e.preventDefault();\n\n  const tutoom = window.tutoom;\n  if (!tutoom || tutoom === undefined) throw new Error(\"Tutoom data is empty\");\n\n  const { isModerator } = tutoom;\n\n  const data = { meetingid: null, ismoderator: isModerator };\n  renderTemplate({ data, type: TEMPLATES.MAIN_SECTION });\n};\n"],"names":["M","mod_tutoom","spinnerHTML","async","tutoom","window","undefined","Error","baseUrl","id","ID","url","ACTIONS_AJAX_MEETING","GET_MEETING","cfg","sesskey","fetch","e","preventDefault","isModerator","elementButton","document","getElementById","widthButton","offsetWidth","lastHTML","innerHTML","style","width","START_MEETING","location","href","response","json","error","roomId","numParticipants","meetingDate","data","errorcode","code","errormessage","message","type","TEMPLATES","MAIN_SECTION","meetingid","ismoderator","meetingdate","participantscount","istextpluralparticipant","console","JOIN_MEETING","joinurl","statuscode","meetingidnotexists","value","target","END_MEETING","deleted","clearMainSection"],"mappings":"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"}