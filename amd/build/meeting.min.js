define("mod_tutoom/meeting",["exports","./lib/actions","./lib/template"],(function(_exports,_actions,_template){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.startMeeting=_exports.joinMeeting=_exports.getMeeting=_exports.endMeeting=_exports.clearMainSection=void 0,M.mod_tutoom=M.mod_tutoom||{};const spinnerHTML="<div class='spinner-border spinner-border-sm text-dark'></div>";_exports.getMeeting=async()=>{const tutoom=window.tutoom;if(!tutoom||void 0===tutoom)throw new Error("Tutoom data is empty");const{baseUrl:baseUrl,id:ID}=tutoom,url="".concat(baseUrl,"?action=").concat(_actions.ACTIONS_AJAX_MEETING.GET_MEETING,"&sesskey=").concat(M.cfg.sesskey,"&id=").concat(ID);return await window.fetch(url)};_exports.startMeeting=async e=>{e.preventDefault();const tutoom=window.tutoom;if(!tutoom||void 0===tutoom)throw new Error("Tutoom data is empty");const{baseUrl:baseUrl,id:ID,isModerator:isModerator}=tutoom,elementButton=document.getElementById("tutoom-start-button"),widthButton=elementButton.offsetWidth,lastHTML=elementButton.innerHTML;elementButton.style.width="".concat(widthButton,"px"),elementButton.innerHTML=spinnerHTML;try{const url="".concat(baseUrl,"?action=").concat(_actions.ACTIONS_AJAX_MEETING.START_MEETING,"&sesskey=").concat(M.cfg.sesskey,"&id=").concat(ID,"&logoutUrl=").concat(window.location.href),fetch=await window.fetch(url),response=await fetch.json(),{error:error,roomId:roomId,numParticipants:numParticipants,meetingDate:meetingDate}=response;if(error){const data={error:!0,errorcode:error.code,errormessage:error.message};(0,_template.renderTemplate)({data:data,type:_template.TEMPLATES.MAIN_SECTION})}if(roomId){const data={meetingid:roomId,ismoderator:isModerator,meetingdate:meetingDate,participantscount:"".concat(numParticipants),istextpluralparticipant:numParticipants>1};(0,_template.renderTemplate)({data:data,type:_template.TEMPLATES.MAIN_SECTION})}}catch(error){console.error(error),elementButton.innerHTML=lastHTML}};_exports.joinMeeting=async e=>{e.preventDefault();const tutoom=window.tutoom;if(!tutoom||void 0===tutoom)throw new Error("Tutoom data is empty");const{baseUrl:baseUrl,id:ID}=tutoom,elementButton=document.getElementById("tutoom-join-button"),widthButton=elementButton.offsetWidth,lastHTML=elementButton.innerHTML;elementButton.style.width="".concat(widthButton,"px"),elementButton.innerHTML=spinnerHTML;try{const url="".concat(baseUrl,"?action=").concat(_actions.ACTIONS_AJAX_MEETING.JOIN_MEETING,"&sesskey=").concat(M.cfg.sesskey,"&id=").concat(ID),fetch=await window.fetch(url),response=await fetch.json(),{error:error,joinurl:joinurl}=response;if(error)if(404===error.statuscode){const data={error:!0,meetingidnotexists:!0};(0,_template.renderTemplate)({data:data,type:_template.TEMPLATES.MAIN_SECTION})}else{const data={error:!0,errorcode:error.code,errormessage:error.message};(0,_template.renderTemplate)({data:data,type:_template.TEMPLATES.MAIN_SECTION})}joinurl&&(window.location.href=joinurl)}catch(error){console.error(error)}finally{elementButton.innerHTML=lastHTML}};_exports.endMeeting=async e=>{e.preventDefault();const tutoom=window.tutoom;if(!tutoom||void 0===tutoom)throw new Error("Tutoom data is empty");const{baseUrl:baseUrl,id:ID}=tutoom,elementButton=document.getElementById("tutoom-end-button"),value=e.target.value,widthButton=elementButton.offsetWidth,lastHTML=elementButton.innerHTML;elementButton.style.width="".concat(widthButton,"px"),elementButton.innerHTML="<div class='spinner-border spinner-border-sm text-danger'></div>";try{const url="".concat(baseUrl,"?action=").concat(_actions.ACTIONS_AJAX_MEETING.END_MEETING,"&sesskey=").concat(M.cfg.sesskey,"&id=").concat(ID,"&meetingId=").concat(value),fetch=await window.fetch(url),response=await fetch.json(),{error:error,deleted:deleted}=response;if(error)if(404===error.statuscode){const data={error:!0,meetingidnotexists:!0};(0,_template.renderTemplate)({data:data,type:_template.TEMPLATES.MAIN_SECTION})}else{const data={error:!0,errorcode:error.code,errormessage:error.message};(0,_template.renderTemplate)({data:data,type:_template.TEMPLATES.MAIN_SECTION})}deleted&&clearMainSection(e)}catch(error){console.error(error)}finally{elementButton.innerHTML=lastHTML}};const clearMainSection=e=>{e.preventDefault();const tutoom=window.tutoom;if(!tutoom||void 0===tutoom)throw new Error("Tutoom data is empty");const{isModerator:isModerator}=tutoom,data={meetingid:null,ismoderator:isModerator};(0,_template.renderTemplate)({data:data,type:_template.TEMPLATES.MAIN_SECTION})};_exports.clearMainSection=clearMainSection}));

//# sourceMappingURL=meeting.min.js.map