define("mod_tutoom/recording",["exports","./lib/actions","./lib/template"],(function(_exports,_actions,_template){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.joinPlayback=_exports.getRecordings=void 0,M.mod_tutoom=M.mod_tutoom||{};const joinPlayback=async e=>{e.preventDefault();const tutoom=window.tutoom;if(!tutoom||void 0===tutoom)throw new Error("Tutoom data is empty");const{baseUrl:baseUrl,id:ID}=tutoom,{meetingid:meetingid}=e.target.dataset;try{const url="".concat(baseUrl,"?action=").concat(_actions.ACTIONS_AJAX_RECORDING.JOIN_PLAYBACK,"&sesskey=").concat(M.cfg.sesskey,"&id=").concat(ID,"&meetingId=").concat(meetingid),fetch=await window.fetch(url),response=await fetch.json(),{error:error,joinurl:joinurl}=response;if(error){const data={error:!0,errorcode:error.code,errormessage:error.message};(0,_template.renderTemplate)({data:data,type:_template.TEMPLATES.MAIN_SECTION})}joinurl&&(window.location.href=joinurl)}catch(error){console.error(error)}};_exports.joinPlayback=joinPlayback;_exports.getRecordings=async _ref=>{let{page:page=1}=_ref;const tutoom=window.tutoom;if(!tutoom||void 0===tutoom)throw new Error("Tutoom data is empty");const{baseUrl:baseUrl,id:ID}=tutoom,elementRecordingTableContent=document.getElementById("tutoom-recordings-table-content"),elementRecordingLoader=document.getElementById("tutoom_view_recordings_loading");try{elementRecordingTableContent.innerHTML="",elementRecordingLoader.style.display="flex";const url="".concat(baseUrl,"?action=").concat(_actions.ACTIONS_AJAX_RECORDING.GET_RECORDINGS,"&sesskey=").concat(M.cfg.sesskey,"&id=").concat(ID,"&page=").concat(page),fetch=await window.fetch(url),{recordings:recordings,pageSize:pageSize,totalRecords:totalRecords}=await fetch.json();let records=[],isemptyrecordings=!1;void 0===recordings?isemptyrecordings=!0:records=recordings.map(((r,index)=>{const renderRowSeparator=!(index===recordings.length-1),{recordingDuration:recordingDuration,creationTime:creationTime,roomId:roomId,recordingThumbnail:recordingThumbnail}=r,language=window.navigator.language,hours=Math.floor(recordingDuration/3600),minutes=Math.floor(recordingDuration%3600/60)+"min";return{meetingid:roomId,thumbnail:recordingThumbnail,duration:hours>0?"".concat(hours,"h ").concat(minutes):minutes,date:new Date(1e3*creationTime).toLocaleString(language,{month:"short",day:"numeric",year:"numeric"}),time:new Date(1e3*creationTime).toLocaleString(language,{hour:"numeric",minute:"numeric",hour12:!0}),renderRowSeparator:renderRowSeparator}}));const callbackBeforeRender=()=>{elementRecordingLoader.style.display="none"},callbackAfterRender=()=>{document.querySelectorAll(".thumbnail").forEach((thumbnail=>{thumbnail.addEventListener("click",joinPlayback)}))};if(await(0,_template.renderTemplate)({data:{recordings:records,isemptyrecordings:isemptyrecordings,countrecordings:totalRecords},type:_template.TEMPLATES.RECORDING_SECTION,callbackBeforeRender:callbackBeforeRender,callbackAfterRender:callbackAfterRender}),null!=recordings){const totalPages=Math.ceil(totalRecords/pageSize),pages=[...Array(totalPages).keys()].map((n=>({number:n+1,isSelected:n+1===page}))),currentPage=pages.findIndex((p=>p.isSelected))+1;if(totalPages>1){const dataPagination={pages:pages,disablePrevious:1===page,disableNext:page===totalPages,currentPage:currentPage};(0,_template.renderTemplate)({data:dataPagination,type:_template.TEMPLATES.RECORDING_PAGINATION})}}}catch(error){console.error(error)}}}));

//# sourceMappingURL=recording.min.js.map