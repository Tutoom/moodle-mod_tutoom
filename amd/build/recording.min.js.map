{"version":3,"file":"recording.min.js","sources":["../src/recording.js"],"sourcesContent":["/* eslint-disable */\n\nimport { ACTIONS_AJAX_RECORDING } from \"./lib/actions\";\nimport { TEMPLATES, renderTemplate } from \"./lib/template\";\n\nM.mod_tutoom = M.mod_tutoom || {};\n\nexport const joinPlayback = async (e) => {\n  e.preventDefault();\n\n  const tutoom = window.tutoom;\n  if (!tutoom || tutoom === undefined) throw new Error(\"Tutoom data is empty\");\n\n  const { baseUrl, id: ID } = tutoom;\n\n  const { meetingid } = e.target.dataset;\n\n  try {\n    const url = `${baseUrl}?action=${ACTIONS_AJAX_RECORDING.JOIN_PLAYBACK}&sesskey=${M.cfg.sesskey}&id=${ID}&meetingId=${meetingid}`;\n    const fetch = await window.fetch(url);\n    const response = await fetch.json();\n\n    const {error, joinurl}  = response;\n\n    if (error) {\n      const data = { error: true, errorcode: error.code, errormessage: error.message };\n      renderTemplate({ data, type: TEMPLATES.MAIN_SECTION });\n    }\n\n    if (joinurl) {\n      window.location.href = joinurl;\n    }\n\n  } catch (error) {\n    console.error(error);\n  }\n};\n\nexport const getRecordings = async ({ page = 1 }) => {\n  const tutoom = window.tutoom;\n  if (!tutoom || tutoom === undefined) throw new Error(\"Tutoom data is empty\");\n\n  const { baseUrl, id: ID } = tutoom;\n\n  const elementRecordingTableContent = document.getElementById(\n    \"tutoom-recordings-table-content\"\n  );\n  const elementRecordingLoader = document.getElementById(\n    \"tutoom_view_recordings_loading\"\n  );\n\n  try {\n    // Show loader recordings.\n    elementRecordingTableContent.innerHTML = \"\";\n    elementRecordingLoader.style.display = \"flex\";\n    \n    const url = `${baseUrl}?action=${ACTIONS_AJAX_RECORDING.GET_RECORDINGS}&sesskey=${M.cfg.sesskey}&id=${ID}&page=${page}`;\n    const fetch = await window.fetch(url);\n    const {recordings, pageSize, totalRecords } = await fetch.json();\n\n\n    let records = []\n    let isemptyrecordings = false\n    if(recordings === undefined){\n      isemptyrecordings = true\n    } else{\n      \n      records = recordings.map((r, index) => {\n      const isLastIndex = index === recordings.length - 1;\n      const renderRowSeparator = !isLastIndex;\n      const { recordingDuration, creationTime, roomId, recordingThumbnail } = r;\n\n      const language = window.navigator.language;\n\n      const hours = Math.floor(recordingDuration / 3600);\n      const minutes = Math.floor((recordingDuration % 3600) / 60) + \"min\";\n\n      const duration = hours > 0 ? `${hours}h ${minutes}` : minutes;\n      \n      const date = new Date(creationTime * 1000).toLocaleString(language, {\n        month: \"short\",\n        day: \"numeric\",\n        year: \"numeric\",\n      });\n      const time = new Date(creationTime * 1000).toLocaleString(language, {\n        hour: \"numeric\",\n        minute: \"numeric\",\n        hour12: true,\n      });\n      \n      return {\n        meetingid: roomId,\n        thumbnail: recordingThumbnail,\n        duration,\n        date,\n        time,\n        renderRowSeparator,\n      };\n    });\n    }\n    \n\n    const callbackBeforeRender = () => {\n      elementRecordingLoader.style.display = \"none\";\n    };\n\n    const callbackAfterRender = () => {\n      const thumbnails = document.querySelectorAll(\".thumbnail\");\n      thumbnails.forEach((thumbnail) => {\n        thumbnail.addEventListener(\"click\", joinPlayback);\n      });\n    };\n\n    await renderTemplate({\n      data: { recordings: records, isemptyrecordings: isemptyrecordings, countrecordings: totalRecords },\n      type: TEMPLATES.RECORDING_SECTION,\n      callbackBeforeRender,\n      callbackAfterRender,\n    });\n\n    \n    if(recordings != undefined){\n\n      const totalPages = Math.ceil(totalRecords / pageSize);\n      const pages = [...Array(totalPages).keys()].map((n) => ({\n        number: n + 1,\n        isSelected: n + 1 === page,\n      }));\n  \n      const currentPage = pages.findIndex((p) => p.isSelected) + 1;\n  \n      if (totalPages > 1) {\n        const dataPagination = {\n          pages,\n          disablePrevious: page === 1,\n          disableNext: page === totalPages,\n          currentPage,\n        };\n  \n        renderTemplate({\n          data: dataPagination,\n          type: TEMPLATES.RECORDING_PAGINATION,\n        });\n      }\n    }\n     \n    \n  } catch (error) {\n    console.error(error);\n  }\n};\n"],"names":["M","mod_tutoom","joinPlayback","async","e","preventDefault","tutoom","window","undefined","Error","baseUrl","id","ID","meetingid","target","dataset","url","ACTIONS_AJAX_RECORDING","JOIN_PLAYBACK","cfg","sesskey","fetch","response","json","error","joinurl","data","errorcode","code","errormessage","message","type","TEMPLATES","MAIN_SECTION","location","href","console","page","elementRecordingTableContent","document","getElementById","elementRecordingLoader","innerHTML","style","display","GET_RECORDINGS","recordings","pageSize","totalRecords","records","isemptyrecordings","map","r","index","renderRowSeparator","length","recordingDuration","creationTime","roomId","recordingThumbnail","language","navigator","hours","Math","floor","minutes","thumbnail","duration","date","Date","toLocaleString","month","day","year","time","hour","minute","hour12","callbackBeforeRender","callbackAfterRender","querySelectorAll","forEach","addEventListener","countrecordings","RECORDING_SECTION","totalPages","ceil","pages","Array","keys","n","number","isSelected","currentPage","findIndex","p","dataPagination","disablePrevious","disableNext","RECORDING_PAGINATION"],"mappings":"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"}